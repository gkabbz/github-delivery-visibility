# GitHubOracle Usage Guide

Quick reference for using GitHubOracle to query GitHub repository activity.

## Basic Command

```bash
ghoracle "your question here"
```

## Query Types

### 1. Specific PR Lookup

Ask about a specific pull request by number:

```bash
ghoracle "Tell me about PR #8127"
ghoracle "What is PR #123?"
ghoracle "Show me details of PR #456"
```

**What it does:** Fetches PR metadata including title, author, description, dates, and changes.

---

### 2. Author Queries

Find PRs by a specific person:

```bash
ghoracle "What did Alice ship last week?"
ghoracle "What has Bob worked on?"
ghoracle "Show me PRs by gkabbz"
```

**What it does:** Searches for PRs authored by the specified person, optionally filtered by time range.

---

### 3. Semantic Search

Find PRs by concept or topic:

```bash
ghoracle "Find PRs about database migrations"
ghoracle "Show me monitoring changes"
ghoracle "Find authentication-related PRs"
ghoracle "What performance improvements were made?"
```

**What it does:** Uses vector embeddings to find PRs semantically similar to your query, even if exact keywords don't match.

---

### 4. Directory/File Queries

Find PRs that changed specific directories or files:

```bash
ghoracle "What changed in the sql/ directory?"
ghoracle "Show PRs that modified config.yaml"
ghoracle "What happened in the tests/ folder?"
```

**What it does:** Filters PRs by files or directories they modified.

---

### 5. Reviewer Queries

Find PRs reviewed by someone:

```bash
ghoracle "What PRs did Alice review?"
ghoracle "Show me reviews by scholtzan"
```

**What it does:** Finds PRs where the specified person submitted a review.

---

### 6. Hybrid Queries

Combine filters with semantic search:

```bash
ghoracle "What authentication changes did Bob make?"
ghoracle "Find monitoring PRs by Alice"
ghoracle "Show database work from last month"
```

**What it does:** Applies both structured filters (author, date) AND semantic search (topic/concept).

---

### 7. BigQuery ETL Table/Dataset Queries

Query by table names, datasets, or file types (for BigQuery ETL repositories):

```bash
# Query by table/view name
ghoracle "What changed in serp_events_clients_daily?"
ghoracle "Show me PRs for events_daily table"

# Query by dataset
ghoracle "What changed in search_derived dataset?"
ghoracle "Find changes to telemetry dataset"

# Query by file type
ghoracle "Show me recent schema changes"
ghoracle "What query logic changed recently?"
ghoracle "Find metadata.yaml updates"

# Combined queries
ghoracle "What schema changes happened in search_derived?"
ghoracle "Show query logic changes in telemetry"
```

**What it does:** Understands BigQuery ETL file structure (`sql/{project}/{dataset}/{table}/{file}`) and intelligently searches by directory or file patterns.

**Recognized file types:**
- `schema.yaml` - Table schemas
- `metadata.yaml` - Table metadata
- `query.sql` / `query.py` - ETL logic
- `init.sql` - Table initialization

---

## Time Ranges

Natural language time expressions work:

```bash
ghoracle "What shipped last week?"
ghoracle "Show PRs from yesterday"
ghoracle "What was merged last month?"
```

**Supported:** last week, yesterday, last month, last N days

---

## Advanced Options

### Verbose Mode

See what's happening under the hood:

```bash
python -m src.github_delivery.cli ask "your question" --verbose
```

Shows:
- Query plan generated by LLM
- SQL queries executed
- Number of results found
- Token usage and costs

### Specify Repository

Query a different repository:

```bash
python -m src.github_delivery.cli ask "your question" --repo mozilla/firefox
```

Default: `mozilla/bigquery-etl` (or whatever is set in your `.env`)

---

## Query Tips

### Be Specific
✅ Good: "What authentication changes did Alice make last week?"
❌ Vague: "What happened?"

### Use Natural Language
✅ Good: "Find PRs about database migrations"
❌ Too technical: "SELECT * WHERE body LIKE '%migration%'"

### Combine Filters
✅ Good: "What monitoring changes did Bob make?"
❌ Less useful: "Show me PRs" (too broad)

### Ask Follow-ups
After getting results, you can ask related questions:
```bash
ghoracle "Tell me about PR #8127"
# Read the answer, then:
ghoracle "Who reviewed this PR?"
ghoracle "What files did it change?"
```

---

## Common Questions

### "No PRs found matching your query"

**Possible reasons:**
- No PRs match your filters
- Date range is empty (e.g., "last week" but no PRs merged then)
- Author name misspelled
- Data not loaded into BigQuery yet

**Try:**
- Broaden your query: "What did Alice ship?" (remove time filter)
- Check spelling: "gkabbz" not "gkabz"
- Verify data exists: Check BigQuery tables

### "Error: API key required"

**Solution:**
```bash
# Check .env file
cat .env | grep ANTHROPIC_API_KEY

# Should see:
ANTHROPIC_API_KEY=sk-ant-...

# If missing, add it:
echo "ANTHROPIC_API_KEY=your_key_here" >> .env
```

### "Command not found: ghoracle"

**Solution:**
```bash
# Add to PATH in ~/.zshrc
echo 'export PATH="$PATH:/path/to/gh-del-visibility"' >> ~/.zshrc

# Reload shell
source ~/.zshrc

# Verify
which ghoracle
```

---

## Query Examples by Use Case

### Daily Standup Prep
```bash
ghoracle "What PRs were merged yesterday?"
ghoracle "What did my team ship last week?"
```

### Code Review
```bash
ghoracle "Tell me about PR #8127"
ghoracle "What PRs need review?"
ghoracle "Show me open PRs by Alice"
```

### Incident Investigation
```bash
ghoracle "Find recent monitoring changes"
ghoracle "What changed in the auth system?"
ghoracle "Show PRs that modified database schemas"
```

### Performance Reviews
```bash
ghoracle "What did Alice ship last quarter?"
ghoracle "Show Bob's contributions from last month"
```

### Documentation
```bash
ghoracle "Find PRs about API changes"
ghoracle "What features were added last month?"
ghoracle "Show me breaking changes"
```

---

## Performance & Result Completeness

### Complete Results by Default

GitHubOracle returns **all matching PRs** by default, not just the top 10 or 20. This ensures comprehensive answers for analytical queries.

**Example:** "What shipped last quarter?" returns all PRs from that period, not just a sample.

### Automatic Chunked Summarization

For queries with more than 20 PRs, GitHubOracle uses **chunked summarization** to handle large result sets:

**How it works:**
1. Splits PRs into chunks of 500
2. Summarizes each chunk independently
3. Synthesizes a comprehensive final answer

**Performance by query size:**
- **1-20 PRs**: Single LLM call, ~5-10 seconds, ~$0.001-0.003
- **20-100 PRs**: Single chunk, ~15-25 seconds, ~$0.003-0.006
- **100-500 PRs**: Single chunk, ~30-40 seconds, ~$0.006
- **500-2000 PRs**: 2-4 chunks, ~60-120 seconds, ~$0.015-0.030

**Quality:** No degradation in answer quality with chunking - you get the same comprehensive analysis regardless of result set size.

### Query Types and Limits

**Structured queries** (author, date, file, directory, reviewer):
- No default limit - returns all matching PRs
- Use for complete historical analysis

**Semantic queries** (topic/concept search):
- Default limit of 20 most relevant PRs
- Uses vector similarity ranking
- More results may not be more meaningful

## Cost per Query

Typical costs (Claude Sonnet 4):
- Simple PR lookup: ~$0.001
- Semantic search (20 results): ~$0.002
- Small query with synthesis (1-20 PRs): ~$0.003
- Large query with chunking (100-500 PRs): ~$0.006
- Very large query (500-2000 PRs): ~$0.015-0.030

**Monthly estimate:** $10-30 for regular use, including some large analytical queries

---

## Getting Help

```bash
# View all CLI commands
python -m src.github_delivery.cli --help

# View help for ask command
python -m src.github_delivery.cli ask --help
```

**Documentation:**
- `README.md` - Full documentation
- `project_plans/project_plan.md` - Implementation details
- `learnings.md` - Technical concepts explained

---

**Pro Tip:** The more natural your question, the better the results. GitHubOracle is designed to understand human language, not SQL syntax!
